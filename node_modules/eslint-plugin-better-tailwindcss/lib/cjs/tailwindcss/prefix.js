"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPrefix = getPrefix;
const node_path_1 = require("node:path");
const synckit_1 = require("synckit");
const config_js_1 = require("./config.js");
const cache_js_1 = require("../async-utils/cache.js");
const version_js_1 = require("../async-utils/version.js");
const worker_js_1 = require("../async-utils/worker.js");
function getPrefix({ configPath, cwd }) {
    const version = (0, version_js_1.getTailwindcssVersion)();
    const { path, warning } = (0, config_js_1.getTailwindConfigPath)({ configPath, cwd });
    return (0, cache_js_1.withCache)("prefix", () => {
        const prefix = getPrefixSync({ configPath: path });
        const suffix = version.major === 3 /* TailwindcssVersion.V3 */ || prefix === ""
            ? ""
            : ":";
        return { prefix, suffix, warnings: [warning] };
    }, date => (0, cache_js_1.invalidateByModifiedDate)(date, path));
}
const getPrefixSync = (0, synckit_1.createSyncFn)(getWorkerPath(), (0, worker_js_1.getWorkerOptions)());
function getWorkerPath() {
    const { major } = (0, version_js_1.getTailwindcssVersion)();
    return (0, node_path_1.resolve)(getCurrentDirectory(), `./prefix.async.v${major}.js`);
}
function getCurrentDirectory() {
    // eslint-disable-next-line eslint-plugin-typescript/prefer-ts-expect-error
    // @ts-ignore - `import.meta` doesn't exist in CommonJS -> will be transformed in build step
    return __dirname;
}
//# sourceMappingURL=prefix.js.map